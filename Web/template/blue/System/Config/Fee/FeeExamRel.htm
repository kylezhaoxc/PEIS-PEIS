<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
<head>
    <title>列表 </title>
    <script type="text/javascript" src="$!{templatepath}/js/JS_Config.js"></script>
    <meta charset="UTF-8" />
</head>
<body>
    <div class="content">
        <div class="widget-box showbox">
            <div class="widget-title bg_lg widget-title-middle">
                &nbsp;收费项目列表 <span style=" font-size:12px; color:666;" id="FeeItemCount"></span>
            </div>
            <input type="hidden" name="txtSectionID" id="Hidden1" value="$!{txtSectionID}" />
            <div class="query-area">
                <div class="query-group">
                    <label class="query-label">
                        隶属科室：</label>
                    <div class="query-controls">
                        
                        <input  class="span150" name="txtSectionInputCode" id="txtSectionInputCode" onkeyup="QuickQueryTableData_Ajax();" onchange="QuickQueryTableData_Ajax();"  onfocus="this.select();QuickQueryTableData_Ajax();"  maxlength="50" value="$!{Section}" />

                        <div>
                        
                    <input type="hidden" name="idSelectSection" id="idSelectSection" value="" />
                    <input type="hidden" name="nameSelectSection" id="nameSelectSection" value="" />

                    <div style="position:absolute; display:block; clear:both; ">
                    <div id="QuickQuerySectionTable" style="min-width:330px; position:relative; border:1px solid #666666; background-color:White; margin-top:-1px; display:none; ">
                        <div style="max-height:180px;overflow:auto">
                        <table style="width:100%;" class="quicktable">
                            <thead>
                            <tr>
                                <td>&nbsp;</td>
                                <td>科室名称</td>
                                <td>输入码</td>
                            </tr>
                            </thead>
                            <tbody id="QuickQuerySectionTableData">
                            <tr>
                                <td colspan="3" style="text-align:center;">未找到相关科室，请重新输入...&nbsp;</td>
                            </tr>
                            </tbody>
                        </table>
                        </div>
                        <div style="width:100%; text-align:center;">

                            <input type="button" class="button80" id="btncolse001" onclick="ShowHideQuickQuerySectionTable(false,'');" value=" 关  闭 " /> 
                            
                        </div>
                    </div>
                    
                    </div>
                    </div>

                    </div>
                </div>
                <div class="query-group" id="SelectedSectionItem">
                    <label class="query-label QuickSelectedItem" id="SelectedSectionLable">
                       &nbsp;
                    </label>
                </div>
                <div class="query-group">
                    <label class="query-label">
                        收费项目 :</label>
                    <div class="query-controls">
                        <input type="text" class="span150" 
                        onfocus="this.select();ShowHideQuickQuerySectionTable(false,'');" 
                        onkeydown="if(IsEnterKeyDown() == true) { FeeKeywordsSearch();ShowHideQuickQuerySectionTable(false,''); }" 
                        id="txtSearchFeeKeyword" name="txtSearchFeeKeyword" />
                    </div>
                </div>
                <div class="query-group">
                    <label class="query-label">
                        <input id="btnSearch" type="button" class="button80" value=" 查  询(F4) " onclick="FeeKeywordsSearch();ShowHideQuickQuerySectionTable(false,'');" />
                    </label>
                </div>
                <div class="query-group" style="float: right;">
                    <input id="Button1" type="button" class="button80" onclick="OpenFeeOperWindow();" value="  新 增  "  />
                    <input id="Button2" type="button" class="button80" onclick="OpenEditFeeItemWindow();" value="  修 改  "  />
                </div>
                <table class="tblList querylist" cellpadding="0" cellspacing="0" border="1" style="width: 100%;">
                    <thead style="font-weight: bold; text-align: center; line-height: 26px;">
                        <tr>
                            <td>
                                <input id="Checkbox11" title="全选" type="hidden" onclick='' /> &nbsp;
                            </td>
                            <td>
                                收费名称
                            </td>
                            <td>
                                隶属科室
                            </td>
                            <td>
                                原始价格
                            </td>
                            <td style=" text-align:center;">
                                男
                            </td>
                            <td style=" text-align:center;">
                                女
                            </td>
                            <td style=" text-align:center;">
                                禁用
                            </td>
                            <td style="width:30px; text-align:center;">
                                早餐顺序
                            </td>
                            <td>
                                输入码
                            </td>
                            <td>
                                标本名称
                            </td>
                            <td>
                                备注
                            </td>
                        </tr>
                    </thead>
                    <tbody id='Searchresult'>
                       
                    </tbody>
                </table>
                <div class="pagination">
                    <ul id="Pagination">
                        <!--
                        <li class="current prev"><a href="javascript:void(0);">上一页</a></li>
                        <li class="current"><a href="javascript:void(0);">1</a></li>
                        <li jquery17204201579934234797="61" href="#"><a href="javascript:void(0);">2</a></li>
                        <li jquery17204201579934234797="62" href="#"><a href="javascript:void(0);">3</a></li>
                        <li jquery17204201579934234797="63" href="#"><a href="javascript:void(0);">4</a></li>
                        <li><a href="javascript:void(0);">...</a></li>
                        <li jquery17204201579934234797="64" href="#"><a href="javascript:void(0);">26</a></li>
                        <li class="next" jquery17204201579934234797="65" href="#">
                        <a href="javascript:void(0);">下一页</a></li>
                        -->
                    </ul>
                </div>
            </div>
            <input type="hidden" name="txtSectionID" id="txtSectionID" value="$!{txtSectionID}" />
            <table class="querylist">
                <thead style="font-weight: bold; text-align: left; line-height: 26px;">
                    <tr>
                        <td class="text_left">
                            
                            <span style="float:left;" id="FeeItemName">
                                检查项目列表
                            </span>
                            
                            <span style="float:left; font-weight:normal; font-size:10px;" id="ExamItemCount">
                                
                            </span>


                            <span style="float: right;">
                                <input id="Button4" onclick="OpenFeeExamRelOperWindow();" type="button" class="button120" value=" 收费项目明细管理 " />
                                &nbsp;&nbsp;&nbsp;
                            </span>
                        </td>
                        <td class="text_left">
                            <span style="float:left;" id="ExamItemName">
                                体征词列表（预览）
                            </span>
                            
                            <span style="float:left; font-weight:normal; font-size:10px;" id="SymptomItemCount">
                                
                            </span>
                            
                        </td>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td style="width: 68%; vertical-align: top; text-align: left; ">
                            <div style="width:660px;overflow:scroll;">
                            <div style="width:1000px;">
                            <table width="100%">
                                <thead>
                                <tr>
                                    <td>
                                        &nbsp;
                                    </td>
                                    <td>
                                        检查ID
                                    </td>
                                    <td>
                                        检查名称
                                    </td>
                                    <td>
                                        输入码
                                    </td>
                                    <td style=" text-align:center;">
                                        男
                                    </td>
                                    <td style=" text-align:center;">
                                        女
                                    </td>
                                    <td style=" text-align:center;">
                                        允许<br/>为空
                                    </td>
                                    <td title="检查项目编码">
                                        检查项<br/>目编码
                                    </td>
                                    <td title="进入科室小结级别">
                                        进入小<br/>结级别
                                    </td>
                                    <td>
                                        单位
                                    </td>
                                    
                                    <td>
                                        低值<br/>(男)
                                    </td>
                                    <td>
                                        高值<br/>(男)
                                    </td>
                                    <td>
                                        低值<br/>(女)
                                    </td>
                                    <td>
                                        高值<br/>(女)
                                    </td>
                                    <td title="隶属于其的体征词是单选还是多选">
                                        多值
                                    </td>
                                    <td title="当前检查项目所隶属的体征词在一行中显示的列数">
                                        列数
                                    </td>
                                    <td title="为放置检查项目汇总所选体征词的文本框，高度是指其占的文本输入行数">
                                        高度
                                    </td>
                                    <td title="体征词与选择的结果是否在同一行">
                                        同行
                                    </td>
                                    <td>
                                        备注
                                    </td>
                                </tr>
                                </thead>
                                <tbody id="FeeExamList">
                                
                                </tbody>
                            </table>
                            </div>
                            </div>
                        </td>
                        <td style="vertical-align: top; text-align: left;">
                            <table class="tablereadonly">
                                <thead>
                                <tr>
                                    <td>
                                        体征词名称
                                    </td>
                                    <td>
                                        结论词
                                    </td>
                                    <td>
                                        病症级别
                                    </td>
                                    <td>
                                        默认值
                                    </td>
                                </tr>
                                </thead>
                                <tbody id="SymptomListItem">
                                    
                                </tbody>
                            </table>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>

    <table style="display:none;">
        <tbody id="FeePagesListItemTemplete">
            <tr onclick="GetExamItemListByFee('@ID_Fee');ShowHideQuickQuerySectionTable(false,'');"
             ondblclick="OpenEditFeeItemWindow();"
             id="trFee_@ID_Fee" >
                <td>
                    <input id="rdiFeeItem_@ID_Fee"title="" type="radio" name='FeeItemRadio' feename="@FeeName" sectionid="@ID_Section" value="@ID_Fee" />
                </td>
                <td id="FeeName_@ID_Fee">@FeeName</td>
                <td id="SectionName_@ID_Fee">@SectionName</td>
                <td id="Price_@ID_Fee" style="text-align:right; padding-right:6px;" >@Price</td>
                <td id="Forsex01_@ID_Fee" style="width:20px; text-align:center;">@Forsex01</td>
                <td id="Forsex00_@ID_Fee" style="width:20px; text-align:center;">@Forsex00 </td>
                <td id="Is_Banned_@ID_Fee" style="width:30px; text-align:center;">@Is_Banned </td>
                <td id="BreakfastOrder_@ID_Fee" style="width:20px; text-align:center;">@BreakfastOrder</td>
                <td id="InputCode_@ID_Fee">@InputCode</td>
                <td id="SpecimenName_@ID_Fee">@SpecimenName</td>
                <td id="Note_@ID_Fee" style="word-break:break-all; max-width:100px;">@Note</td>
            </tr>
        </tbody>
        <tbody id="ExamListItemTemplete">
            <tr onclick="GetSymptomDetailListByExamID('@ID_ExamItem');" ondblclick="OpenFeeExamRelOperWindow();" >
                <td>
                    <input id="rdi_ExamItem_@ID_ExamItem"  title="" type="radio" examname="@ExamName" name='SymptomItemCheckbox' />
                </td>
                <td>@ID_ExamItem</td>
                <td>@ExamName</td>
                <td>@InputCode</td>
                <td style="width:20px; text-align:center;">@Forsex01</td>
                <td style="width:20px; text-align:center;">@Forsex00</td>
                <td style="width:30px; text-align:center;">@Is_LisValueNull</td>
                <td style="word-break:break-all;">@ExamItemCode</td>
                <td style="width:40px; text-align:center;">@EntrySectSumLevel</td>
                <td>@ExamItemUnit</td>
                <td>@MaleLoLimit</td>
                <td>@MaleHiLimit</td>
                <td>@FemaleLoLimit</td>
                <td>@FemaleHiLimit</td>
                <td style="width:20px; text-align:center;">@Is_SymMultiValue</td>
                <td style="width:20px; text-align:center;">@TextboxRows</td>
                <td style="width:20px; text-align:center;">@SymCols</td>
                <td style="width:20px; text-align:center;">@Is_SameRow</td>
                <td style="text-align:left;word-break:break-all;">@Note</td>
            </tr>
        </tbody>
        <tbody id="SymptomListItemTemplete">
            <tr>
                <tr>
                    <td>@SymptomName</td>
                    <td>@ConclusionName</td>
                    <td>@DiseaseLevel</td>
                    <td>@Is_Default</td>
                    
                </tr>
            </tr>
        </tbody>
    </table>
    
    <table style="display:none;">
    <tbody id="SectionQuickQueryTableTemplete">
        <tr onclick="SetSectionChecked('@ID_Section')">
            <td>
            <input type="radio" name="@chkSectionQueryList" id="chkSection_@ID_Section" 
                value="@ID_Section"
                SectionName="@SectionName"  />
            </td>
            <td>@SectionName</td>
            <td>@InputCode</td>
        </tr>
    </tbody>
    <tbody id="EmptySectionQuickQueryDataTemplete">
        <tr>
            <td colspan="3" style="text-align:center;">未找到相关科室，请重新输入...&nbsp;</td>
        </tr>
    </tbody>
        
        
    </table>
    <div id="SecectedSectionLableTemplete" style="display:none;">
    <a title="删除" href="javascript:void(0);" onclick="RemoveSelectedSection();"> × </a> @SectionName 
    </div>
</body>
</html>



    <script type="text/javascript">


        /// <summary> 
        /// 点击选中对应科室的单选按钮（快速选择列表）
        /// </summary>
        function SetSectionChecked(ID_Section) {
            jQuery("#chkSection_" + ID_Section).attr("checked", true);
            SelectQuerySection(ID_Section);
        }

        /// <summary> 
        /// 移除选择的科室
        /// </summary>
        function RemoveSelectedSection() {
            // 清除显示的科室名称
            jQuery('#SelectedSectionLable').html("");

            // 清除单项框的选中值
            jQuery("input[name='chkSectionQueryList']:radio").each(function () {
                jQuery(this).attr("checked", false);
            });

            jQuery('#idSelectSection').val("");         // 清空选择的科室ID
            jQuery('#nameSelectSection').val("");       // 清空选择的科室名称

            // 重新查询数据
            FeeKeywordsSearch();
        }

        /// <summary> 
        /// 选择科室（快速选择）
        /// </summary>
        function SelectQuerySection(ID_Section) {
            
            // 从模版中读取数据加载列表
            var templateContent = jQuery('#SecectedSectionLableTemplete').html();
            if (templateContent == undefined) { return; }
            var tempSectionName = jQuery("#chkSection_" + ID_Section).attr("SectionName");

            var newcontent = templateContent.replace(/@SectionName/gi, tempSectionName); // 替换模版中的关键字

            jQuery('#SelectedSectionLable').html(newcontent);   // 显示到页面
            jQuery('#idSelectSection').val(ID_Section);         // 选择的科室ID
            jQuery('#nameSelectSection').val(tempSectionName);  // 选择的科室名称

            // 重新查询数据
            FeeKeywordsSearch();
        }


        // 记录读取分页数据操作的次数，用于判断是否进行回调
        // 1、只有第1次才调用 jQuery("#Pagination").pagination
        // 2、只有第2次及以后的操作才调用回调函数 pageselectCallback 中的 QueryPagesData(page_index );
        var tempOperPageCount = 0;
        var tempOldtotalCount = 0; //初始总页数，用于判断是否更新页码

        function pageselectCallback(page_index, jq) {

            if (tempOperPageCount > 0) {
                QueryPagesData(page_index);
            }
            tempOperPageCount++;

            return false;
        }

        jQuery(document).ready(function () {
            QueryPagesData(0);               // 读取用户信息
        });


        /// <summary>
        /// 按照关键字搜索
        /// </summary>
        function FeeKeywordsSearch() {

            tempOperPageCount = 0;
            QueryPagesData(0); //重新按照新输入的条件进行查询

        }


        /// <summary>
        /// 按条件进行分页查询
        /// </summary>
        function QueryPagesData(pageIndex) {
            var optInit;
            optInit = getOptionsFromForm();
            var totalCount = 0;

            var SearchFeeKeyword = jQuery('#txtSearchFeeKeyword').val();      // 收费项目关键字
            var SelectedSectionID = jQuery('#idSelectSection').val();      // 已选择的科室

            jQuery.ajax({
                type: "GET",
                url: "/Ajax/AjaxConfig.aspx",
                data: { pageIndex: pageIndex,
                    SearchFeeKeyword: SearchFeeKeyword,
                    SelectedSectionID: SelectedSectionID,
                    pageSize: pagePagination.items_per_page,
                    action: 'SearchFeeList',
                    date: encodeURIComponent(new Date())
                },
                cache: false,
                dataType: "json",
                success: function (msg) {
                    if (parseInt(msg.totalCount) > 0) {

                        jQuery("#FeeItemCount").html(" 【共有 " + msg.totalCount + " 个收费项目】");

                        jQuery("#Pagination").show();
                        if (tempOperPageCount == 0) {
                            jQuery("#Pagination").pagination(msg.totalCount, optInit);
                            tempOldtotalCount = msg.totalCount;
                        }
                        else if (tempOldtotalCount != msg.totalCount) {
                            jQuery("#Pagination").pagination(msg.totalCount, optInit);
                        }


                        var newcontent = "";
                        // 从模版中读取数据加载列表
                        var templateContent = jQuery('#FeePagesListItemTemplete').html();
                        if (templateContent == undefined) { return; }
                        var Forsex01 = ""; // 男性是否选中
                        var Forsex00 = ""; // 女性是否选中
                        var txtBreakfastOrder = ""; // 早餐顺序
                        var tempFirstItemID = 0;  // 记录第一个数据的ID
                        jQuery(msg.dataList).each(function (i, item) {

                            if (item.Forsex == '2') {
                                Forsex01 = "√";
                                Forsex00 = "√";
                            } else if (item.Forsex == '1') {
                                Forsex01 = "√";
                                Forsex00 = "-";
                            } else {
                                Forsex01 = "-";
                                Forsex00 = "√";
                            }

                            switch (item.BreakfastOrder) {
                                case "1": txtBreakfastOrder = "<span class='red'>A</span>"; break; // 餐前
                                case "2": txtBreakfastOrder = "<span class='blue'>B</span>"; break; // 早餐
                                case "3": txtBreakfastOrder = "C"; break; // 餐前后均可
                                case "4": txtBreakfastOrder = "D"; break; // 餐后
                            }

                            newcontent +=
                             templateContent.replace(/@FeeName/gi, item.FeeName)
                            .replace(/@SectionName/gi, item.SectionName)
                            .replace(/@ID_Section/gi, item.ID_Section)
                            .replace(/@ID_Fee/gi, item.ID_Fee)
                            .replace(/@Price/gi, item.Price)
                            .replace(/@Forsex00/gi, Forsex00)
                            .replace(/@Forsex01/gi, Forsex01)
                            .replace(/@SpecimenName/gi, item.SpecimenName)
                            .replace(/@InputCode/gi, item.InputCode)
                            .replace(/@BreakfastOrder/gi, txtBreakfastOrder)
                            .replace(/@Is_Banned/gi, item.Is_Banned == 'True' ? '√' : '')
                            .replace(/@Note/gi, item.Note)
                            ;
                            // 记录第一个收费项目的ID
                            if (tempFirstItemID == 0) {
                                tempFirstItemID = item.ID_Fee;
                            }
                        });

                        if (newcontent != '') {
                            jQuery("#Searchresult").html(newcontent);

                            jQuery("#FeeItemName").html("检查项目列表");
                            jQuery("#ExamItemCount").html("");

                            // 自动读取第一行对应的检查项目
                            if (tempFirstItemID != 0) { GetExamItemListByFee(tempFirstItemID); }
                        }

                    } else {
                        jQuery("#Pagination").hide();
                    }
                }
            });

        }


        /// <summary>
        /// 获取修改或新增的单条收费项目的数据
        /// </summary>
        function GetSingleFeeItem(ID_Fee, type) {
            
            jQuery.ajax({
                type: "GET",
                url: "/Ajax/AjaxConfig.aspx",
                data: { ID_Fee: ID_Fee,
                    action: 'GetSingleFeeItem',
                    date: encodeURIComponent(new Date())
                },
                cache: false,
                dataType: "json",
                success: function (msg) {

                    if (msg != null && msg != "" && parseInt(msg.totalCount) > 0) {

                        var newcontent = "";

                        var templateContent = jQuery('#FeePagesListItemTemplete').html();
                        if (templateContent == undefined) { return; }
                        var Forsex01 = ""; // 男性是否选中
                        var Forsex00 = ""; // 女性是否选中
                        var txtBreakfastOrder = ""; // 早餐顺序
                        var tempFirstItemID = 0;  // 记录第一个数据的ID
                        jQuery(msg.dataList0).each(function (i, item) {

                            if (item.Forsex == '2') {
                                Forsex01 = "√";
                                Forsex00 = "√";
                            } else if (item.Forsex == '1') {
                                Forsex01 = "√";
                                Forsex00 = "-";
                            } else {
                                Forsex01 = "-";
                                Forsex00 = "√";
                            }

                            switch (item.BreakfastOrder) {
                                case "1": txtBreakfastOrder = "<span class='red'>A</span>"; break; // 餐前
                                case "2": txtBreakfastOrder = "<span class='blue'>B</span>"; break; // 早餐
                                case "3": txtBreakfastOrder = "C"; break; // 餐前后均可
                                case "4": txtBreakfastOrder = "D"; break; // 餐后
                            }

                            if (type == "edit") {
                                jQuery("#FeeName_" + item.ID_Fee).html(item.FeeName);
                                jQuery("#SectionName_" + item.ID_Fee).html(item.SectionName);
                                jQuery("#Price_" + item.ID_Fee).html(item.Price);
                                jQuery("#Forsex00_" + item.ID_Fee).html(Forsex00);
                                jQuery("#Forsex01_" + item.ID_Fee).html(Forsex01);
                                jQuery("#SpecimenName_" + item.ID_Fee).html(item.SpecimenName);
                                jQuery("#InputCode_" + item.ID_Fee).html(item.InputCode);
                                jQuery("#BreakfastOrder_" + item.ID_Fee).html(txtBreakfastOrder);
                                jQuery("#Is_Banned_" + item.ID_Fee).html(item.Is_Banned == 'True' ? '√' : '');
                                jQuery("#Note_" + item.ID_Fee).html(item.Note);
                            } else {

                                newcontent +=
                                     templateContent.replace(/@FeeName/gi, item.FeeName)
                                    .replace(/@SectionName/gi, item.SectionName)
                                    .replace(/@ID_Section/gi, item.ID_Section)
                                    .replace(/@ID_Fee/gi, item.ID_Fee)
                                    .replace(/@Price/gi, item.Price)
                                    .replace(/@Forsex00/gi, Forsex00)
                                    .replace(/@Forsex01/gi, Forsex01)
                                    .replace(/@SpecimenName/gi, item.SpecimenName)
                                    .replace(/@InputCode/gi, item.InputCode)
                                    .replace(/@BreakfastOrder/gi, txtBreakfastOrder)
                                    .replace(/@Is_Banned/gi, item.Is_Banned == 'True' ? '√' : '')
                                    .replace(/@Note/gi, item.Note)
                                    ;

                                // 将新增加的数据，追加到列表的第一行位置
                                jQuery("#Searchresult").prepend(newcontent);
                            }

                        });
                    }
                }
            });
        }


    </script>
